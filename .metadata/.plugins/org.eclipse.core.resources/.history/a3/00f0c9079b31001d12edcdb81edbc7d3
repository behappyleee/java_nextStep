package webserver;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class HttpRequest {
	
	Logger logger = LoggerFactory.getLogger(this.getClass());
	
	BufferedReader br;
	
	String firstHeaderLine;
	
	String allData;
	
	public HttpRequest(InputStream in) {
		try {
			InputStreamReader reader = new InputStreamReader(in);
	    	this.br = new BufferedReader(reader);
	    	this.firstHeaderLine = br.readLine();
	    	String line;
	    	StringBuilder builder = new StringBuilder();
	    	while((line = br.readLine()) != null) {
	    		builder.append(line + "\n");
	    	}
	    	allData =  builder.toString();
		} catch(IOException e) {
			e.printStackTrace();
		} catch(Exception e) {
			e.printStackTrace();
		}
	}
	
	public String getMethod() {
		return firstHeaderLine.split(" ")[0];
	}
	
	public String getPath() {
		String path = firstHeaderLine.split(" ")[1];
		if(path.contains("?")) {
			return path.split("\\?")[0];
		} else {
			return path;
		}
	}
	
	public String getHeader(String selectHeader) {
		try {
			String [] readLine = allData.split("\n");
			for(int i=0; i<readLine.length; i++) {
				if(readLine[i].contains(selectHeader)) {
					return readLine[i].split(":")[1].trim();
				}
			}
			return null;
		} catch(Exception e) {
			e.printStackTrace();
		}
		return null;
	}
	
	public String getParameter(String parameter) {
		if(firstHeaderLine.contains("?")) {
			String [] params = firstHeaderLine.split("\\?")[1].split("&");
			for(String i : params) {
				String[] eachParam = i.split("="); 
				if(eachParam[0].equals(parameter)) {
					return eachParam[1];
				}
			}
		} else {
			String [] readLine = allData.split("\n");
			if(!readLine[readLine.length-1].contains(":")) {
				String[] postParameter = readLine[readLine.length-1].split("&");
				for(int i=0; i<postParameter.length; i++) {
					if(postParameter[i].contains(parameter)) {
						return postParameter[i].split("=")[1];	
					}
				}
			}
			return null;
		}
		return null;
	}

	
}
